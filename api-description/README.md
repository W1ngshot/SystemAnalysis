# Описание эндпоинтов мессенджера

## Описание эндпоинта `Получение информации о групповом чате`

### 1. Протокол взаимодействия  

**HTTP/1.1 & REST**  

### 2. Метод запроса  

**GET**  

### 3. URL  

`/group-chat/{conversationId}/info`  

### 4. Используемые заголовки  

- `Accept: application/json`  
- `Authorization: Bearer <токен>`  

### 5. Требования  

#### 5.1. Аутентификация/Авторизация  

- **Необходимость**: Обязательно.  
- **Как работает**: Для выполнения запроса требуется передача валидного Bearer токена в заголовке `Authorization`.  

#### 5.2. Кэширование  

- **Необходимость**: Опционально.  
- **Как работает**:  
  - Клиенты могут использовать заголовки кэширования (`Cache-Control` или `ETag`) для минимизации запросов.   

### 6. Структура запроса  

| **Параметр**     | **Передача** | **Обязательность** | **Тип данных** | **Описание**                            | **Условия валидации**         | **Значения по умолчанию / Допустимые значения** |
|------------------|--------------|--------------------|----------------|-----------------------------------------|-------------------------------|-------------------------------------------------|
| `conversationId` | `path`       | Обязательный       | `string`       | Уникальный идентификатор чата           | Должен быть валидным UUID     | Нет значения по умолчанию                       |

### 7. Структура ответа  

| **Поле**         | **Передача**   | **Тип данных** | **Обязательность** | **Описание**                                         | **Допустимые значения**             |
|------------------|----------------|----------------|--------------------|------------------------------------------------------|-------------------------------------|
| `id`             | `body`         | `string`       | Обязательный       | Уникальный идентификатор чата                        | Валидный UUID                       |
| `title`          | `body`         | `string`       | Обязательный       | Заголовок чата                                       | Строка длиной не более 100 символов |
| `description`    | `body`         | `string`       | Необязательный     | Описание чата                                        | Строка длиной не более 500 символов |
| `pictureId`      | `body`         | `string`       | Необязательный     | Идентификатор изображения чата                       | Валидный UUID                       |
| `lastUpdatedAt`  | `body`         | `string`       | Обязательный       | Дата и время последнего обновления информации о чате | Корректное значение даты и времени    |

### 8. Алгоритм обработки запроса

- #### 8.1 Валидации
  - Валидация `conversationId` на уровне роутинга на соответствие UUID.

- #### 8.2 Обработки
  - Получение данных из `GroupChatMembers` по `user_id` и `conversation_id`
  - Проверка существования записи
  - Проверка полей `is_excluded` и `is_banned`
  - Получение данных из `GroupChatInfos` по `conversation_id`

- #### 8.3 Наполнение из БД
  - Таблица `GroupChatInfos`
    - `conversation_id`
    - `title`
    - `description`
    - `picture_id`
    - `last_updated_at`

- #### 8.4 Используемые таблицы
  - `GroupChatMembers`
  - `GroupChatInfos`

- #### 8.5 Вызовы других систем в рамках обработки
  - **Keycloak:**
    - Запрос метаданных авторизации для проверки подлинности токена (если их нет в кэше)  

### 9. Код состояния ответа

- `200 OK`: Успешное выполнение запроса.
- `401 Unauthorized`: Отсутствует или неверный токен.
- `403 Forbidden`: Пользователь не является действующим участником чата.
- `404 Not Found`: Так как за валидацию `conversationId` отвечает роутинг ASP .NET, то при невалидном UUID энпоинт просто не найдется.
- `500 Internal Server Error`: Внутренняя ошибка сервера.

### 10. Ошибки

#### 401 Unauthorized

- **Response body:** Отсутствует.

#### 403 Forbidden

- **Response body:**
  ```json 
  {
    "title": "title",
    "status": 403
  }
  ```

- **Titles:**
  - `NOT_CHAT_MEMBER`: Пользователь не состоит в чате.
  - `WAS_BANNED`: Пользователь был забанен в чате.
  - `WAS_EXCLUDED`: Пользователь был исключен из чата.

#### 404 Not Found

- **Response body:** Отсутствует.

#### 500 Internal Server Error

- **Response body:**
  ```json 
  {
    "title": "INTERNAL_SERVER_ERROR",
    "status": 500
  }
  ```

### 11. Примеры запроса и ответа

#### Пример запроса

```http
GET /group-chat/4d0a8fa6-364f-4141-b0d3-b21cacaf300a/info HTTP/1.1  
Host: api.messenger.com  
Accept: application/json  
Authorization: Bearer token
```

#### Пример ответа

```http
HTTP/1.1 200 OK  
Content-Type: application/json  
```

**Response body:**
```json
{
  "id": "4d0a8fa6-364f-4141-b0d3-b21cacaf300a",
  "title": "Sample title",
  "description": "Sample description",
  "pictureId": "3f85f64-5717-4562-b3fc-2c963f66af6",
  "lastUpdated": "2025-01-23T08:28:31.877Z"
}
```


---